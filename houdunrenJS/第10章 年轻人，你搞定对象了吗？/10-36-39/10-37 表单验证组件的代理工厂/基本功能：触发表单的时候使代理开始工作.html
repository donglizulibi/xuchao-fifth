<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <style>
        body {
            padding: 50px;
            background: #34495e;
        }
        
        input {
            border: solid 10px #ddd;
            height: 30px;
        }
        
        .error {
            border: solid 10px red;
        }
    </style>
</head>

<body>
    <input type="text" validate rule="max:12,min:3">
    <input type="text" validate rule="max:3,isNumber">
    <script>
        "use strict";
        // 先定义一个提供功能验证的类
        class Validate {
            max(value, len) {
                return value.length > len;
            }
            min(value, len) {
                return value.length < len;
            }
            isNumber(value) {
                // 如果是个数值就表示合法
                return /^\d+$/.test(value);
            }
            haha() {
                return 123
            }
        }

        // 测试验证模块
        let validate = new Validate();
        console.log(validate.haha)
        console.log(validate.haha())
        console.log(validate.max('abc', 5)) // 表示填入一个数据，然后判断这个数据是不是大于这个长度
        console.log(validate.isNumber('abc'))
        console.log(validate.isNumber('123'))

        // 代理工厂
        // 这个案例中不是所有表单都需要验证，只有包含validate这个属性的表单才需要验证
        function ProxyFactory(target) {
            return new Proxy(target, {
                get(obj, property) {
                    // console.log(obj)
                    // console.log(property)
                    return obj[property]
                },
                set(obj, property, el) {
                    console.log('联系了吗 ')
                    console.log(obj) // 打印表单元素的集合
                    console.log(property) // 打印角标
                    console.log(el) // 打印这个角标对应的元素 就是那个this
                    return true
                }
            });
        }

        // 实验一下这个函数
        console.log(ProxyFactory({
            name: '我好困',
            age: 19
        }))

        // 找到包含某个属性的标签的方法
        // document.querySelectorAll('[...]')
        // console.log(document.querySelectorAll('[validate]'))
        // 也就是说，某个元素中只有出现了validate的时候，才会启动这个验证功能
        const proxy = ProxyFactory(document.querySelectorAll('[validate]'))
        console.log(proxy)
        console.log(proxy[0])
        console.log(proxy[1])

        // 把代理中的元素对象遍历出来
        proxy.forEach((item, i) => {
            console.log(item, i) // i是角标
            item.addEventListener('keyup', function() {
                console.log(this)

                // 下面这一步就是把键盘抬起事件和代理器中的set联系起来
                // 但凡要联系set，都有一个“类似于赋值的过程”
                // 严格模式下set函数要return true
                // 里面再加一个打印来验证是否真的联系上了
                proxy[i] = this;
            })
        })
    </script>
</body>

</html>