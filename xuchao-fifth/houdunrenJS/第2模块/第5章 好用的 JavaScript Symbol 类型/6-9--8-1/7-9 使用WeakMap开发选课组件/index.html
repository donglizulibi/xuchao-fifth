<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <style>
        * {
            padding: 0;
            margin: 0;
        }
        
        body {
            padding: 20px;
            width: 100vw;
            display: flex;
            box-sizing: border-box;
        }
        
        div {
            border: solid 2px #ddd;
            padding: 10px;
            flex: 1;
        }
        
        div:last-of-type {
            margin-left: -2px;
        }
        
        ul {
            list-style: none;
            display: flex;
            width: 200px;
            flex-direction: column;
        }
        
        li {
            height: 30px;
            border: solid 2px #e67e22;
            margin-bottom: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding-left: 10px;
            color: #333;
            transition: 1s;
        }
        
        a {
            border-radius: 3px;
            width: 20px;
            height: 20px;
            text-decoration: none;
            text-align: center;
            background: #16a085;
            color: white;
            cursor: pointer;
            display: flex;
            justify-content: center;
            align-items: center;
            margin-right: 5px;
        }
        
        .remove {
            border: solid 2px #eee;
            opacity: 0.8;
            color: #eee;
        }
        
        .remove a {
            background: #eee;
        }
        
        p {
            margin-top: 20px;
        }
        
        p span {
            display: inline-block;
            background: #16a085;
            padding: 5px;
            color: white;
            margin-right: 10px;
            border-radius: 5px;
            margin-bottom: 10px;
        }
    </style>
</head>

<body>
    <div>
        <ul>
            <li><span>php</span> <a href="javascript:;">+</a></li>
            <li><span>js</span> <a href="javascript:;">+</a></li>
            <li><span>向军讲编程</span><a href="javascript:;">+</a></li>
        </ul>
    </div>
    <div>
        <strong id="count">共选了0门课</strong>
        <p id="lists"></p>
    </div>
    <script>
        class lesson {
            constructor() {
                this.lis = document.querySelectorAll("ul>li")
                this.countelem = document.getElementById("count")
                this.listelem = document.getElementById("lists")
                console.log(this.lis)
                console.log(this.count)
                console.log(this.lists)
                this.map = new WeakMap()

                // 定义构造函数的一个方法，所有的交互动作都放在另一个函数里面
                // 与constructor并列
            }
            run() {
                this.lis.forEach((li) => {
                    // li.querySelector('a').addEventListener('click', function(event) {


                    li.querySelector('a').addEventListener('click', (event) => {
                        // 这里又出现一个箭头函数的问题，在this.lis的循环是箭头函数的情况下，
                        // 如果事件监听的函数是箭头函数，则this会指向整个lesson对象
                        // 如果是普通函数，则会指向当前的选中的a标签
                        // 在本例中并不影响，因为要用的是event

                        // 这个点击事件的意义就是，当点击加号的时候，会往map里添加元素
                        // console.log(this)
                        console.log(event.target) // target 事件属性可返回事件的目标节点（触发该事件的节点）
                            // alert(this.innerHTML)
                        let a = event.target
                        console.log(a.innerHTML)
                        let state = li.getAttribute('select');
                        console.log(state)

                        if (!state) {
                            // 这里表示在没有被选中的情况下点击了按钮，也就是需要达到被选中的状态
                            // 选中的一系列动作是 1 +变成- 2 将数据传入weakmap
                            a.innerHTML = "-";
                            li.setAttribute('select', true);
                            this.map.set(li);
                            a.style.backgroundColor = 'red'
                        } else { // 这里表示在选择的状态，需要让数据回到没有被选的状态
                            a.innerHTML = "+";
                            li.removeAttribute('select');
                            this.map.delete(li)
                            a.style.backgroundColor = 'green'
                        }
                        console.log(this.map) // 这个动作仍然要在点击事件里发生

                        // 点击事件里面还应该有渲染右边的视图
                        // let p = document.createElement('p')
                        // p.innerHTML = li.innerText
                        // lis

                        // 好吧！直接定义一个渲染函数
                        this.render()
                    })
                })
            }

            // 已选几门课的计数函数
            count() {
                return [...this.lis].reduce((count, li) => {
                    return count += (this.map.has(li) ? 1 : 0)
                }, 0)
            }

            // 已选的选课记录
            lists() {
                console.log([...this.lis].filter((item) => {
                    return this.map.has(item)
                }).map(li => {
                    return `<span>${li.querySelector('span').innerHTML}</span>`
                }).join(''))


                return [...this.lis].filter((item) => {
                    return this.map.has(item)
                }).map(li => {
                    return `<span>${li.querySelector('span').innerHTML}</span>`
                }).join('')
            }

            // 右边视图的渲染函数
            render() {
                // 首先是“共选了几门课”
                console.log('我是渲染函数')
                    // 再在里面添加一个计数的函数
                this.countelem.innerHTML = `共选了${this.count()}门课`
                this.listelem.innerHTML = this.lists()
            }
        }
        new lesson().run()
    </script>
</body>

</html>